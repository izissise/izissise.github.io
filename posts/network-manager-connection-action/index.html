<!doctype html><html lang=en><html class="dark light"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§±</text></svg>"><link rel=monetization href=https://ilp.gatehub.net/669637781/eur><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Network manager connection action","author":{"@type":"Person","name":"Hugues Morisset","url":"https://blog.izissise.net/about"},"datePublished":"2021-03-06"}</script><title>Network manager connection action</title><meta property="og:title" content="Network manager connection action"><script defer src=/js/codecopy.js></script><script defer src=/js/ofuscate.js></script><script data-goatcounter=https://izissise.goatcounter.com/count async src=/js/count.js></script><noscript><img style=display:none src="https://izissise.goatcounter.com//count?p=/posts/network-manager-connection-action/&t=Network manager connection action"></noscript><link rel=alternate type=application/atom+xml title href=/atom.xml><link rel=stylesheet media=screen href=/main.css><div class=content><header><nav><a href=/posts style=margin-left:.7em>/posts</a>
<a href=/about style=margin-left:.7em>/about</a>
<a href=/atom.xml style=margin-left:.7em>/rss</a>
|
<i id=mode class="adjust icon" type=reset></i>
<script src=/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Network manager connection action</div><div class=meta><span>Posted on <time>2021-03-06</time></span>
<span style=float:right;text-align:right>2 minutes read</span></div></div><section class=body><h2 id=genesis><a class=zola-anchor href=#genesis aria-label="Anchor link for: genesis">Genesis</a></h2><p>It as always been kind of a hassle to do actions upon connecting to a network using network manager, especially if you want your script to run a with user permissions.<p>Maybe you work for multiple companies and you want to setup and run some program when connecting to their VPN.<p>You could setup an up rule on your openvpn configuration but it would run as root, and only works for openvpn.<p>Why if instead you could have a program that watches network-manager events and run pre-specified commands?<p>Look no more and go check-out <a rel=noopener target=_blank href=https://github.com/izissise/network-manager-connection-action>network-manager-connection-action</a>.<h2 id=how><a class=zola-anchor href=#how aria-label="Anchor link for: how">How</a></h2><p>This program is written in Rust and uses Tokio projects to connect to dbus and listen for event from network-manager, if an event come from a connection for which the UUID exist in config file, it runs the associated command.<h2 id=ssh-canonicalization-usage><a class=zola-anchor href=#ssh-canonicalization-usage aria-label="Anchor link for: ssh-canonicalization-usage">SSH canonicalization usage</a></h2><p>I personally been using this program to automatically setup <a rel=noopener target=_blank href=https://dotfiles.tnetconsulting.net/articles/2016/0109/ssh-canonicalization.html>ssh canonicalization</a> on the company search domains when connecting to the VPN.<p>With the following ssh configuration at the top:<pre data-lang=config class="language-config z-code"><code class=language-config data-lang=config><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig">##################
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig">#Canonicalization#
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig">##################
</span></span></span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Don&#39;t canonicalize host with dots (assume there are already full hostname)
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">CanonicalizeMaxDots</span> </span><span class="z-constant z-numeric z-genconfig">0</span>
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Fallback to local name Resolution in any case
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">CanonicalizeFallbackLocal</span> </span><span class="z-constant z-language z-genconfig">yes</span>
</span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">CanonicalizeHostname</span> </span><span class="z-constant z-language z-genconfig">yes</span>
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Include static list
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Include</span> </span>static_canonical_domains<span class="z-keyword z-operator z-genconfig">.</span>conf
</span><span class="z-source z-genconfig">
</span><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Include script generated list of CanonicalDomains
</span></span></span><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">Include</span> </span><span class="z-support z-type z-genconfig">tmp/canonical_domains.conf</span>
</span></code></pre><p><code>tmp/canonical_domains.conf</code> is generated using <a rel=noopener target=_blank href=https://github.com/izissise/network-manager-connection-action/blob/master/example/ssh_canonicalization_gen.sh>ssh_canonicalization_gen.sh</a> when connecting to the company VPN.<p>It will transform the file into this:<pre data-lang=config class="language-config z-code"><code class=language-config data-lang=config><span class="z-source z-genconfig"><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">CanonicalDomains</span> </span>internal<span class="z-keyword z-operator z-genconfig">.</span>company<span class="z-keyword z-operator z-genconfig">.</span>com historic<span class="z-keyword z-operator z-genconfig">.</span>company<span class="z-keyword z-operator z-genconfig">.</span>com
</span></code></pre><p>This usage can be found in repository's example directory</section></article></main></div><footer><hr><nav style=float:right><a rel=me href=/about>Hugues</a> |
<a rel=atom href=/atom.xml class="rss icon"></a><a rel=me href=https://github.com/izissise class="github icon" style=border-bottom:none></a><a rel=me href=https://stackoverflow.com/users/2838914/izissise class="stack icon" style=border-bottom:none></a><a rel=me href=https://links.izissise.net/ class="shaarli icon" style=border-bottom:none></a><a rel=me href=https://www.linkedin.com/in/huguesmorisset/ class="linkedin icon" style=border-bottom:none></a><a rel=me href="=MWM2IDZ1cDN0ATMwEDMyEjYxEmM5QDMwIWNmFjYxQDMkFDNyYDNxATMygDNwEDOwEWM3MjM1QDM" class="m-protected matrix icon" style=border-bottom:none></a><a rel=me href="==wYwQWMiBjZ0QDMhJjM1QDM2AjMzIWM0ADZxQjM2QTMwYGN2ADZwITMiFTYyEDN2AzYwgDN3ATNxQDMhJjM1QDM" class="m-protected mail icon" style=border-bottom:none></a>| &#169; 2025