<!doctype html><html lang=en><html class="dark light"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§±</text></svg>"><link rel=monetization href=https://ilp.gatehub.net/669637781/eur><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Remote bash function with ssh","author":{"@type":"Person","name":"Hugues Morisset","url":"https://blog.izissise.net/about"},"datePublished":"2021-03-08"}</script><title>Remote bash function with ssh</title><meta property="og:title" content="Remote bash function with ssh"><script defer src=/js/codecopy.js></script><script defer src=/js/ofuscate.js></script><script data-goatcounter=https://izissise.goatcounter.com/count async src=/js/count.js></script><noscript><img style=display:none src="https://izissise.goatcounter.com//count?p=/posts/remote_bash_func_ssh/&t=Remote bash function with ssh"></noscript><link rel=alternate type=application/atom+xml title href=/atom.xml><link rel=stylesheet media=screen href=/main.css><div class=content><header><nav><a href=/posts style=margin-left:.7em>/posts</a>
<a href=/about style=margin-left:.7em>/about</a>
<a href=/atom.xml style=margin-left:.7em>/rss</a>
|
<i id=mode class="adjust icon" type=reset></i>
<script src=/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Remote bash function with ssh</div><div class=meta><span>Posted on <time>2021-03-08</time></span>
<span style=float:right;text-align:right>2 minutes read</span></div></div><section class=body><h1 id=genesis><a class=zola-anchor href=#genesis aria-label="Anchor link for: genesis">Genesis</a></h1><p>Often when a shell command line start to become a little long,
I like to break it down into functions.<p>But things start to get complicated when it involve a remote host.<p>It usually involve spawning a remote shell with ssh and then double escaping lot of characters (ssh and remote shell) in order to properly execute commands.<p>Another solution exist though and it's usage it really simple, just write your commands in a function and pass it's name to a magic wrapper that will on remote host re-export it.<h1 id=how><a class=zola-anchor href=#how aria-label="Anchor link for: how">How</a></h1><p>Has show in this excellent <a rel=noopener target=_blank href="https://www.youtube.com/watch?v=uqHjc7hlqd0">video</a>, <code>bash</code> has a <code>declare</code> builtin that can re-export local function into string (automatically taking care of escaping).<p>Thus one can pass these generated string to <code>ssh</code>, so functions are re-exported on remote hosts.<p>Also <code>bash</code> support nested function, you can create and export namespaces this way:<pre data-lang=bash class="language-bash z-code"><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">namespace</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">    <span class="z-entity z-name z-function z-shell">func2</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ls</span></span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">    <span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">    <span class="z-entity z-name z-function z-shell">func1</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">func2</span></span>
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-meta z-function z-shell">    <span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">func1</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">func</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>namespace<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ssh</span></span><span class="z-meta z-function-call z-arguments z-shell"> host <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-storage z-modifier z-shell">declare</span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>f</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">$func</span></span><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span>; <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">func</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre><h1 id=why><a class=zola-anchor href=#why aria-label="Anchor link for: why">Why</a></h1><p>bash and ssh are ubiquitous and existed for a long time. Plus the shell will allow you to run virtually anything on the remote system.<h1 id=where><a class=zola-anchor href=#where aria-label="Anchor link for: where">Where</a></h1><p>You can find an helper function here: <a rel=noopener target=_blank href=https://github.com/izissise/shell_utils/blob/main/ssh_exec_func.bash>shell_utils</a>, you need to copy the function into your <code>~/.bash_aliases</code>.<p>It export <code>ssh_exec_func</code>:<pre data-lang=bash class="language-bash z-code"><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-entity z-name z-function z-shell">do_stuff</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span> <span class="z-punctuation z-section z-braces z-begin z-shell">{</span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">hostname</span></span>
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function z-shell"><span class="z-punctuation z-section z-braces z-end z-shell">}</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ssh_exec_func</span></span><span class="z-meta z-function-call z-arguments z-shell"> host<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> do_stuff hello</span>
</span></code></pre><h1 id=more><a class=zola-anchor href=#more aria-label="Anchor link for: more">More</a></h1><p>Stay tuned for a post that'll push this concept further.</section></article></main></div><footer><hr><nav style=float:right><a rel=me href=/about>Hugues</a> |
<a rel=atom href=/atom.xml class="rss icon"></a><a rel=me href=https://github.com/izissise class="github icon" style=border-bottom:none></a><a rel=me href=https://stackoverflow.com/users/2838914/izissise class="stack icon" style=border-bottom:none></a><a rel=me href=https://links.izissise.net/ class="shaarli icon" style=border-bottom:none></a><a rel=me href=https://www.linkedin.com/in/huguesmorisset/ class="linkedin icon" style=border-bottom:none></a><a rel=me href="=MWM2IDZ1cDN0ATMwEDMyEjYxEmM5QDMwIWNmFjYxQDMkFDNyYDNxATMygDNwEDOwEWM3MjM1QDM" class="m-protected matrix icon" style=border-bottom:none></a><a rel=me href="==wYwQWMiBjZ0QDMhJjM1QDM2AjMzIWM0ADZxQjM2QTMwYGN2ADZwITMiFTYyEDN2AzYwgDN3ATNxQDMhJjM1QDM" class="m-protected mail icon" style=border-bottom:none></a>| &#169; 2025