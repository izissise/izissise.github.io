<!doctype html><html lang=en><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§±</text></svg>"><link rel=monetization href=https://ilp.gatehub.net/669637781/eur><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Parallel bash function call","author":{"@type":"Person","name":"Hugues Morisset","url":"https://blog.izissise.net/about"},"datePublished":"2022-01-15"}</script><title>Parallel bash function call</title><meta property="og:title" content="Parallel bash function call"><script defer src=/js/codecopy.js></script><script defer src=/js/ofuscate.js></script><script data-goatcounter=https://izissise.goatcounter.com/count async src=/js/count.js></script><noscript><img style=display:none src="https://izissise.goatcounter.com//count?p=/posts/parallel_and_bash_function/&t=Parallel bash function call"></noscript><link rel=alternate type=application/atom+xml title href=/atom.xml><link rel=stylesheet media=screen href=/main.css><div class=content><header><nav><a href=/posts>/posts</a>
<a href=/about>/about</a>
<a href=/atom.xml>/rss</a>
|
<button id=theme type=reset title="switch theme">ðŸŒ“</button>
<script src=/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Parallel bash function call</div><div class=meta><span>Posted on <time datetime=2022-01-15>2022-01-15</time></span>
<span class=readingtime>1 minutes read</span></div></div><section class=body><h1 id=introduction><a class=zola-anchor href=#introduction aria-label="Anchor link for: introduction">Introduction</a></h1><p>Now that we can execute <a href=/remote_bash_func_ssh>bash functions remotly</a>, we can scale the execution using <a rel="noopener external" target=_blank href=https://www.gnu.org/software/parallel/>GNU Parallel</a>.<p>When one wants to make a change or retrieve one particular piece of information on a whole set of machines, multiple choice are available (ansible, puppet, pssh, consul, ...) each with their own upsides and downsides.<p>Parallel + ssh + func can give a combination of upsides that I haven't seen elsewhere:<ul><li>No prerequisite on remote machine<li>Minimum requisite on local machine (bash, ssh, parallel)<li>Blazing fast thanks to parallel<li>Use plain bash, no new DSL or weird escaping<li>Use shell tools that you already know</ul><p>For example in fifteen seconds we're able to retrieve 1448 host kernel versions:<pre class="giallo z-code"><code data-lang=shellscript><span class=giallo-l><span class="z-entity z-name">$</span><span class=z-string> kernel_version</span><span>()</span><span class=z-string> { uname</span><span class=z-constant> -r</span><span class=z-keyword> |</span><span class="z-entity z-name"> sed</span><span class="z-punctuation z-definition z-string z-string"> &#39;s/\([0-9].[0-9]*\).*/\1/&#39;</span><span>; }</span></span>
<span class=giallo-l><span class="z-entity z-name">$</span><span class=z-string> time parallel_host_list_ssh_func hosts.txt kernel_version</span><span class=z-constant> -j 250</span><span class=z-keyword> |</span><span class="z-entity z-name"> sort</span><span class=z-keyword> |</span><span class="z-entity z-name"> uniq</span><span class=z-constant> -c</span><span class=z-keyword> |</span><span class="z-entity z-name"> sort</span><span class=z-constant> -n</span></span>
<span class=giallo-l><span class="z-entity z-name">      2</span><span class=z-constant> 5.17</span></span>
<span class=giallo-l><span class="z-entity z-name">    467</span><span class=z-constant> 5.23</span></span>
<span class=giallo-l><span class="z-entity z-name">    979</span><span class=z-constant> 5.12</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name">real</span><span class=z-string>    0m15,380s</span></span>
<span class=giallo-l><span class="z-entity z-name">user</span><span class=z-string>    0m49,900s</span></span>
<span class=giallo-l><span class="z-entity z-name">sys</span><span class=z-string>     0m26,688s</span></span></code></pre><h1 id=where><a class=zola-anchor href=#where aria-label="Anchor link for: where">Where</a></h1><p>You can find an helper functions here: <a rel="noopener external" target=_blank href=https://github.com/izissise/shell_utils/blob/main/parallel_helpers.bash>shell_utils</a>, you need to copy the functions into your <code>~/.bash_aliases</code>.</section></article></main></div><footer><hr><nav><a rel=me href=/about>Hugues</a> |
<a rel=atom href=/atom.xml class="rss icon" title=rss></a><a rel=me href=https://github.com/izissise class="github icon" title=github></a><a rel=me href=https://stackoverflow.com/users/2838914/izissise class="stack icon" title=stackoverflow></a><a rel=me href=https://links.izissise.net/ class="shaarli icon" title=shaarli></a><a rel=me href=https://www.linkedin.com/in/huguesmorisset/ class="linkedin icon" title=linkedin></a><a rel=me href="=MWM2IDZ1cDN0ATMwEDMyEjYxEmM5QDMwIWNmFjYxQDMkFDNyYDNxATMygDNwEDOwEWM3MjM1QDM" class="m-protected matrix icon" title=matrix></a><a rel=me href="==wYwQWMiBjZ0QDMhJjM1QDM2AjMzIWM0ADZxQjM2QTMwYGN2ADZwITMiFTYyEDN2AzYwgDN3ATNxQDMhJjM1QDM" class="m-protected mail icon" title=email></a>| &#169; 2026