<!doctype html><html lang=en><html class="dark light"><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§±</text></svg>"><link rel=monetization href=https://ilp.gatehub.net/669637781/eur><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Qemu IPv6 Slirp","author":{"@type":"Person","name":"Hugues Morisset","url":"https://blog.izissise.net/about"},"datePublished":"2024-04-12"}</script><title>Qemu IPv6 Slirp</title><meta property="og:title" content="Qemu IPv6 Slirp"><script defer src=/js/codecopy.js></script><script defer src=/js/ofuscate.js></script><script data-goatcounter=https://izissise.goatcounter.com/count async src=/js/count.js></script><noscript><img style=display:none src="https://izissise.goatcounter.com//count?p=/posts/qemuipv6slirp/&t=Qemu IPv6 Slirp"></noscript><link rel=alternate type=application/atom+xml title href=/atom.xml><link rel=stylesheet media=screen href=/main.css><div class=content><header><nav><a href=/posts style=margin-left:.7em>/posts</a>
<a href=/about style=margin-left:.7em>/about</a>
<a href=/atom.xml style=margin-left:.7em>/rss</a>
|
<i id=mode class="adjust icon" type=reset></i>
<script src=/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Qemu IPv6 Slirp</div><div class=meta><span>Posted on <time>2024-04-12</time></span>
<span style=float:right;text-align:right>2 minutes read</span></div></div><section class=body><p>Qemu support rootless mode routing of network packets through the host using <a rel=noopener target=_blank href=https://en.wikipedia.org/wiki/Slirp>Slirp</a>,
you only need to give the right options to qemu to set this up, without having to tinker with tap interfaces or iptables.<p>However, using it for IPv6 can be a bit more challenging, especially since the <a rel=noopener target=_blank href=https://wiki.qemu.org/Documentation/Networking>documentation</a> lacks IPv6 examples.<p>The Qemu options look like this <code>-device virtio-net-pci,netdev=n0,mac=52:54:12:34:56:00 -netdev user,id=n0,ipv4=off,ipv6=on,ipv6-net=??</code>. The only unknown is what to put for <code>ipv6-net</code>.<p>One would guess that using a <a rel=noopener target=_blank href=https://en.wikipedia.org/wiki/IPv6_address#Special_addresses>Unique Local Address</a> would work, but Qemu will only route packets out of the guest for IPs in the specified network.<p>The trick is to give <code>::/0</code> for the network, this way Qemu will route everything out of the guest.<h1 id=test><a class=zola-anchor href=#test aria-label="Anchor link for: test">Test</a></h1><p>We download an <a rel=noopener target=_blank href=https://cloud-images.ubuntu.com/jammy/current/>Ubuntu cloud image</a>, mask systemd-networkd-wait-online and change the root password with libguestfs<sup class=footnote-reference id=fr-1-1><a href=#fn-1>1</a></sup>:<pre data-lang=sh class="language-sh z-code"><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">virt-customize</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>a</span> jammy-server-cloudimg-amd64-disk-kvm.img<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>run-command</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>systemctl mask systemd-networkd-wait-online.service<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">virt-customize</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>a</span> jammy-server-cloudimg-amd64-disk-kvm.img<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>root-password</span> password:root</span>
</span></code></pre><p>Then we run:<pre data-lang=bash class="language-bash z-code"><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">qemu-system-<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">HOSTTYPE</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span> 2G<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>nographic</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>serial</span> mon:stdio<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>nodefaults</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>enable-kvm</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>drive</span> file=jammy-server-cloudimg-amd64-disk-kvm.img,format=qcow2<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>device</span> virtio-net-pci,netdev=n0,mac=52:54:12:34:56:00<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>netdev</span> user,id=n0,ipv4=off,ipv6=on,ipv6-net=::/0 <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Press CTRL+a CTRL+x to quit qemu</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></span></code></pre><p>Setup network in guest:<pre data-lang=tty class="language-tty z-code"><code class=language-tty data-lang=tty><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">root@ubuntu:~#</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ip</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">link</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">set</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ens2</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">up</span></span></span>                                       <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-shell">#</span> Bring iface up
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">root@ubuntu:~#</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">echo</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>nameserver 2606:4700:4700::1111<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span> <span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">/etc/resolv.conf</span></span></span></span> <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-shell">#</span> use cloudflare DNS
</span></span></code></pre><p>We get an IPv6 and route are configured:<pre data-lang=tty class="language-tty z-code"><code class=language-tty data-lang=tty><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">root@ubuntu:~#</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ip</span></span> <span class="z-meta z-parameter z-option z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>6</span></span> <span class="z-meta z-parameter z-option z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">--</span>brief</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">a</span></span></span>                                           <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-shell">#</span> we get an ipv6
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">lo</span></span></span><span class="z-meta z-function-call z-arguments z-shell">               <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">UNKNOWN</span></span>        <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">::1/128</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">ens2</span></span></span><span class="z-meta z-function-call z-arguments z-shell">             <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">UP</span></span>             <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">::5054:12ff:fe34:5600/64</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">fe80::5054:12ff:fe34:5600/64</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">root@ubuntu:~#</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ip</span></span> <span class="z-meta z-parameter z-option z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>6</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">r</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">::1</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">dev</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">lo</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">proto</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">kernel</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">metric</span></span> <span class="z-meta z-number z-integer z-decimal z-shell"><span class="z-constant z-numeric z-value z-shell">256</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">pref</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">medium</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">::<span class="z-punctuation z-separator z-path z-shell">/</span>64</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">dev</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ens2</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">proto</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">kernel</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">metric</span></span> <span class="z-meta z-number z-integer z-decimal z-shell"><span class="z-constant z-numeric z-value z-shell">256</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">expires</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">86274sec</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">pref</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">medium</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">fe80::<span class="z-punctuation z-separator z-path z-shell">/</span>64</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">dev</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ens2</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">proto</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">kernel</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">metric</span></span> <span class="z-meta z-number z-integer z-decimal z-shell"><span class="z-constant z-numeric z-value z-shell">256</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">pref</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">medium</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">default</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">via</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">fe80::2</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">dev</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ens2</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">proto</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ra</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">metric</span></span> <span class="z-meta z-number z-integer z-decimal z-shell"><span class="z-constant z-numeric z-value z-shell">1024</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">expires</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">1674sec</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">hoplimit</span></span> <span class="z-meta z-number z-integer z-decimal z-shell"><span class="z-constant z-numeric z-value z-shell">64</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">pref</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">medium</span></span></span>
</span></code></pre><p>Ping doesn't work<sup class=footnote-reference id=fr-2-1><a href=#fn-2>2</a></sup>:<pre data-lang=tty class="language-tty z-code"><code class=language-tty data-lang=tty><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">root@ubuntu:~#</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ping</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">google.com</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">PING</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">google.com</span></span><span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">(par21s23-in-x0e.1e100.net</span></span> <span class="z-meta z-string z-glob z-shell"></span><span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">(2a00:1450:4007:81a::200e</span></span></span><span class="z-invalid z-illegal z-stray z-shell">)</span><span class="z-invalid z-illegal z-stray z-shell">)</span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">56</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">data</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">bytes</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">qemu-system-x86_64:</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">Slirp:</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">external</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">icmpv6</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">not</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">supported</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">yet</span></span></span>
</span></code></pre><p>But curl does:<pre data-lang=tty class="language-tty z-code"><code class=language-tty data-lang=tty><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">root@ubuntu:~#</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">curl</span></span> <span class="z-meta z-parameter z-option z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>v</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ifconfig.me</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell"><span class="z-constant z-other z-wildcard z-asterisk z-shell">*</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell">   <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">Trying</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">2600:1901:0:bbc3:::80...</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell"><span class="z-constant z-other z-wildcard z-asterisk z-shell">*</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">Connected</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">to</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">ifconfig.me</span></span> <span class="z-meta z-string z-glob z-shell"></span><span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">(2600:1901:0:bbc3::</span></span></span><span class="z-invalid z-illegal z-stray z-shell">)</span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">port</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-number z-integer z-decimal z-shell"><span class="z-constant z-numeric z-value z-shell">80</span></span> <span class="z-meta z-string z-glob z-shell"></span><span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">(#0</span></span></span><span class="z-invalid z-illegal z-stray z-shell">)</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">GET</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell"><span class="z-punctuation z-separator z-path z-shell">/</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">HTTP/1.1</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">Host:</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">ifconfig.me</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">User-Agent:</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">curl<span class="z-punctuation z-separator z-path z-shell">/</span>7.81.0</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">Accept:</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell"><span class="z-constant z-other z-wildcard z-asterisk z-shell">*</span><span class="z-punctuation z-separator z-path z-shell">/</span><span class="z-constant z-other z-wildcard z-asterisk z-shell">*</span></span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell"><span class="z-constant z-other z-wildcard z-asterisk z-shell">*</span></span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">Mark</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">bundle</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">as</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">not</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">supporting</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">multiuse</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">HTTP/1.1</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">200</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">OK</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">server:</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">fasthttp</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">date:</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">Thu,</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-number z-integer z-decimal z-shell"><span class="z-constant z-numeric z-value z-shell">11</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">Apr</span></span> <span class="z-meta z-number z-integer z-decimal z-shell"><span class="z-constant z-numeric z-value z-shell">2024</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">08:16:58</span></span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">GMT</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">content-type:</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">text<span class="z-punctuation z-separator z-path z-shell">/</span>plain</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">Content-Length:</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">38</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">access-control-allow-origin:</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell"><span class="z-constant z-other z-wildcard z-asterisk z-shell">*</span></span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">via:</span></span></span> <span class="z-meta z-function-call z-identifier z-shell"><span class="z-meta z-command z-shell"><span class="z-variable z-function z-shell">1.1</span></span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">google</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span><span class="z-meta z-string z-glob z-shell"><span class="z-string z-unquoted z-shell">redacted-ip6</span></span></span><span class="z-meta z-redirection z-shell"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span></span>                                                   <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-shell">#</span> Slirp translated host ip6
</span></span></code></pre><p>After bringing up the iface, we get an ip on <code>::/0</code>, we use cloudflare nameserver and can use curl to get our IPv6.<p>We end up with the host IPv6 because it goes trough Slirp.<h1 id=debug><a class=zola-anchor href=#debug aria-label="Anchor link for: debug">Debug</a></h1><p>You can also add <code>-object filter-dump,id=d0,netdev=n0,file=dump.pcap</code> to get a pcap file of the VM network.<p>That's all for today, have fun with IPv6.<section class=footnotes><ol class=footnotes-list><li id=fn-1><p>Despite my best efforts, I couldn't make cloud-init work. Maybe it could have its own blog post, but today we're only interested in the Qemu IPv6 Slirp stack. <a href=#fr-1-1>â†©</a><li id=fn-2><p><a rel=noopener target=_blank href=https://github.com/qemu/libslirp/blob/v4.7.0/src/ip6_icmp.c#L419>https://github.com/qemu/libslirp/blob/v4.7.0/src/ip6_icmp.c#L419</a>. <a href=#fr-2-1>â†©</a></ol></section></section></article></main></div><footer><hr><nav style=float:right><a rel=me href=/about>Hugues</a> |
<a rel=atom href=/atom.xml class="rss icon"></a><a rel=me href=https://github.com/izissise class="github icon" style=border-bottom:none></a><a rel=me href=https://stackoverflow.com/users/2838914/izissise class="stack icon" style=border-bottom:none></a><a rel=me href=https://links.izissise.net/ class="shaarli icon" style=border-bottom:none></a><a rel=me href=https://www.linkedin.com/in/huguesmorisset/ class="linkedin icon" style=border-bottom:none></a><a rel=me href="=MWM2IDZ1cDN0ATMwEDMyEjYxEmM5QDMwIWNmFjYxQDMkFDNyYDNxATMygDNwEDOwEWM3MjM1QDM" class="m-protected matrix icon" style=border-bottom:none></a><a rel=me href="==wYwQWMiBjZ0QDMhJjM1QDM2AjMzIWM0ADZxQjM2QTMwYGN2ADZwITMiFTYyEDN2AzYwgDN3ATNxQDMhJjM1QDM" class="m-protected mail icon" style=border-bottom:none></a>| &#169; 2025