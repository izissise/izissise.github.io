<!doctype html><html lang=en><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§±</text></svg>"><link rel=monetization href=https://ilp.gatehub.net/669637781/eur><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Allowlist for .gitignore","author":{"@type":"Person","name":"Hugues Morisset","url":"https://blog.izissise.net/about"},"datePublished":"2026-01-25"}</script><title>Allowlist for .gitignore</title><meta property="og:title" content="Allowlist for .gitignore"><meta property="og:image" content="https://blog.izissise.net/posts/gitignoreallowlist/art.png"><script defer src=/js/codecopy.js></script><script defer src=/js/ofuscate.js></script><script data-goatcounter=https://izissise.goatcounter.com/count async src=/js/count.js></script><noscript><img style=display:none src="https://izissise.goatcounter.com//count?p=/posts/gitignoreallowlist/&t=Allowlist for .gitignore"></noscript><link rel=alternate type=application/atom+xml title href=/atom.xml><link rel=stylesheet media=screen href=/main.css><div class=content><header><nav><a href=/posts>/posts</a>
<a href=/about>/about</a>
<a href=/atom.xml>/rss</a>
|
<button id=theme type=reset title="switch theme">ðŸŒ“</button>
<script src=/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Allowlist for .gitignore</div><div class=meta><span>Posted on <time datetime=2026-01-25>2026-01-25</time></span>
<span class=readingtime>3 minutes read</span></div></div><section class=body><img src=/posts/gitignoreallowlist/art.png alt="daemon meme" width=1162 height=508 loading=lazy><p>At my current job, while reorganizing our company's root git monorepo, we decided to adopt a <code>.gitignore</code> allowlist pattern.<p>I had previously experimented with this approach on <a href=/posts/raconn#git>raconn</a>, but this monorepo is significantly larger. The complexity required a dedicated script to generate the <code>.gitignore</code> file effectively.<h2 id=why-use-an-allowlist><a class=zola-anchor href=#why-use-an-allowlist aria-label="Anchor link for: why-use-an-allowlist">Why use an allowlist?</a></h2><h3 id=pros><a class=zola-anchor href=#pros aria-label="Anchor link for: pros">Pros:</a></h3><ul><li><strong>Pure state:</strong> You know exactly what is being tracked and must explicitly write tracking patterns.<li><strong>No unintended files:</strong> Prevents accidental commits of secrets, large binaries, or build artifacts.</ul><h3 id=cons><a class=zola-anchor href=#cons aria-label="Anchor link for: cons">Cons:</a></h3><ul><li><strong>Noise:</strong> Spurious files aren't listed as untracked, making them harder to spot.<li><strong>Maintenance:</strong> The <code>.gitignore</code> must be regenerated.</ul><h2 id=git-gotchas><a class=zola-anchor href=#git-gotchas aria-label="Anchor link for: git-gotchas">Git gotchas</a></h2><p>By default, every line in a <code>.gitignore</code> file is a pattern to exclude. Files matching these patterns cannot be added to version control easily and do not appear as untracked in <code>git status</code>.<p>The <a rel="noopener external" target=_blank href=https://git-scm.com/docs/gitignore#_pattern_format>Git documentation</a> states the following regarding negation:<blockquote><p>An optional prefix "!" which negates the pattern; any matching file excluded by a previous pattern will become included again. It is not possible to re-include a file if a parent directory of that file is excluded. Git doesnâ€™t list excluded directories for performance reasons, so any patterns on contained files have no effect, no matter where they are defined.</blockquote><h2 id=starting-point><a class=zola-anchor href=#starting-point aria-label="Anchor link for: starting-point">Starting point</a></h2><p>To build an allowlist, we start by ignoring everything with <code>/**/*</code> and then selectively adding file extensions. For a Rust project, a naive <code>.gitignore</code> might look like this:<pre class="giallo z-code"><code data-lang=gitignore data-name=.gitignore><span class=giallo-l><span class=z-comment># ignore everything</span></span>
<span class=giallo-l><span>/</span><span class=z-keyword>**</span><span>/</span><span class=z-keyword>*</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/.gitignore</span></span>
<span class=giallo-l><span class=z-keyword>!**</span><span>/</span><span class=z-keyword>*</span><span>.rs</span></span>
<span class=giallo-l><span class=z-keyword>!**</span><span>/Cargo.toml</span></span></code></pre><p>If your repository looks like this:<pre class="giallo z-code"><code data-lang=shellsession><span class=giallo-l><span>$ tree</span></span>
<span class=giallo-l><span class="z-meta z-output">.</span></span>
<span class=giallo-l><span class="z-meta z-output">â”œâ”€â”€ .gitignore</span></span>
<span class=giallo-l><span class="z-meta z-output">â””â”€â”€ crate-a</span></span>
<span class=giallo-l><span class="z-meta z-output">    â”œâ”€â”€ Cargo.toml</span></span>
<span class=giallo-l><span class="z-meta z-output">    â””â”€â”€ src</span></span>
<span class=giallo-l><span class="z-meta z-output">        â””â”€â”€ main.rs</span></span></code></pre><p>Running <code>git status</code> will unexpectedly show only the <code>.gitignore</code> file:<pre class="giallo z-code"><code data-lang=shellsession><span class=giallo-l><span>$ git status</span></span>
<span class=giallo-l><span class="z-meta z-output">On branch main</span></span>
<span class=giallo-l><span class="z-meta z-output">Untracked files:</span></span>
<span class=giallo-l><span class="z-meta z-output">        .gitignore</span></span></code></pre><p>This happens because git does not list excluded directories for performance reasons and we ignored everything. To fix this, we must "unignore" all directories so git can traverse them to find allowed files:<pre class="giallo z-code"><code data-lang=gitignore data-name=.gitignore><span class=giallo-l><span class=z-comment># ignore everything</span></span>
<span class=giallo-l><span>/</span><span class=z-keyword>**</span><span>/</span><span class=z-keyword>*</span></span>
<span class=giallo-l><span class=z-comment># allow all directories</span></span>
<span class=giallo-l><span class=z-keyword>!**</span><span>/</span></span>
<span class=giallo-l><span class=z-comment># allow specific files</span></span>
<span class=giallo-l><span class=z-keyword>!**</span><span>/</span><span class=z-keyword>*</span><span>.rs</span></span>
<span class=giallo-l><span>...</span></span></code></pre><p>It is best to explicitly tell git not to look into commonly ignored directories (like target/ or node_modules/), as they might contain allowed file extensions that we don't want tracked.<h2 id=a-script-is-born><a class=zola-anchor href=#a-script-is-born aria-label="Anchor link for: a-script-is-born">A script is born</a></h2><p>Managing this manually is complex, especially when mixing multiple projects and programming languages in a single monorepo, to alleviate some of the pain, I created a generation script.<p>I used some fun bash idioms to keep it concise.<p><code>println() { printf "%s\n" "$@"; }</code> every parameters to <code>println</code> will be printed on a new line.<p><code>"${@/#/param}"</code> in a function will expands to <code>"paramA" "paramB" "paramC"</code> when called with <code>func A B C</code>.<p>Some git command were of great help while searching for missing patterns that should be allowed,
<code>git ls-files --others --ignored --exclude-standard</code> will list all files that are currently ignored,
with this and a fresh clone of the repo, it make it easier to spot files that are tracked but ignored.<p>With these helpers, we can go up the abstraction ladder to build <code>allow</code> and <code>deny</code> functions and in turn build <code>files</code> and <code>exts</code> to create language specific allowlists.<p>Here is the script:<pre class="giallo z-code"><code data-lang=shellscript data-name=gengitignore.sh><span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">#!/usr/bin/env -S bash -o nounset -o pipefail -o errexit</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment"># https://blog.izissise.net/posts/gitignoreallowlist/</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment"># helpers</span></span>
<span class=giallo-l><span class="z-entity z-name">println</span><span>() {</span><span class=z-support> printf</span><span class="z-punctuation z-definition z-string z-string"> &quot;%s\n&quot; &quot;</span><span class=z-variable>$@</span><span class="z-punctuation z-definition z-string">&quot;</span><span>; }</span></span>
<span class=giallo-l><span class="z-entity z-name">header</span><span>()  {</span></span>
<span class=giallo-l><span class="z-entity z-name">    println</span><span class=z-constant> \</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-string z-string">        &quot;# This file is generated by &#39;</span><span class=z-variable>$0</span><span class=z-string>&#39; do NOT modify ($(</span><span class="z-entity z-name">date</span><span class="z-punctuation z-definition z-string z-string"> &quot;+%Y-%m-%d&quot;))&quot;</span><span class=z-constant> \</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-string z-string">        &quot;# Commit &#39;$(</span><span class="z-entity z-name">git</span><span class=z-string> rev-list</span><span class=z-constant> --max-count=1</span><span class="z-string z-punctuation z-definition z-string"> HEAD)&#39;&quot;</span></span>
<span class=giallo-l><span>}</span></span>
<span class=giallo-l><span class="z-entity z-name">denyallfiles</span><span>() {</span><span class="z-entity z-name"> println</span><span class="z-punctuation z-definition z-string z-string"> &quot;/**/*&quot;</span><span>; }</span></span>
<span class=giallo-l><span class="z-entity z-name">allowalldirs</span><span>() {</span><span class="z-entity z-name"> println</span><span class="z-punctuation z-definition z-string z-string"> &quot;!**/&quot;</span><span>; }</span></span>
<span class=giallo-l><span class="z-entity z-name">allow</span><span>()        {</span><span class="z-entity z-name"> println</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@/#/!/</span><span class="z-string z-punctuation z-definition z-string">}&quot;</span><span>; }</span></span>
<span class=giallo-l><span class="z-entity z-name">deny</span><span>()         {</span><span class="z-entity z-name"> println</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@/#//</span><span class="z-string z-punctuation z-definition z-string">}&quot;</span><span>; }</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name">files</span><span>() {</span><span class="z-punctuation z-definition z-comment z-comment"> # allow files, usage: files BASE_PATH [FILES]...</span></span>
<span class=giallo-l><span class=z-storage>    local</span><span class="z-variable z-other"> p</span><span class=z-keyword>=</span><span class=z-variable>$1</span><span>;</span><span class="z-support z-constant"> shift 1</span><span>;</span></span>
<span class=giallo-l><span class="z-entity z-name">    allow</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@/#/</span><span class=z-string>${</span><span class="z-variable z-other">p</span><span class=z-string>}</span><span class=z-keyword>/</span><span class="z-string z-punctuation z-definition z-string">}&quot;</span></span>
<span class=giallo-l><span>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name">exts</span><span>() {</span><span class="z-punctuation z-definition z-comment z-comment"> # allow extensions, usage: exts BASE_PATH [EXTS]...</span></span>
<span class=giallo-l><span class=z-storage>    local</span><span class="z-variable z-other"> p</span><span class=z-keyword>=</span><span class=z-variable>$1</span><span>;</span><span class="z-support z-constant"> shift 1</span><span>;</span></span>
<span class=giallo-l><span class="z-entity z-name">    allow</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@/#/</span><span class=z-string>${</span><span class="z-variable z-other">p</span><span class=z-string>}</span><span class=z-keyword>/*</span><span class="z-string z-punctuation z-definition z-string">.}&quot;</span></span>
<span class=giallo-l><span>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name">css</span><span>()    {</span><span class=z-keyword> for</span><span class="z-variable z-other"> p</span><span class=z-keyword> in</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@</span><span class="z-string z-punctuation z-definition z-string">}&quot;</span><span>;</span><span class=z-keyword> do</span><span class="z-entity z-name"> exts</span><span class="z-punctuation z-definition z-string"> &quot;</span><span class="z-variable z-other">$p</span><span class="z-punctuation z-definition z-string z-string">&quot; css scss coffee less</span><span>;</span><span class=z-keyword> done</span><span>; }</span></span>
<span class=giallo-l><span class="z-entity z-name">fonts</span><span>()  {</span><span class=z-keyword> for</span><span class="z-variable z-other"> p</span><span class=z-keyword> in</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@</span><span class="z-string z-punctuation z-definition z-string">}&quot;</span><span>;</span><span class=z-keyword> do</span><span class="z-entity z-name"> exts</span><span class="z-punctuation z-definition z-string"> &quot;</span><span class="z-variable z-other">$p</span><span class="z-punctuation z-definition z-string z-string">&quot; ttf woff woff2 otf eot</span><span>;</span><span class=z-keyword> done</span><span>; }</span></span>
<span class=giallo-l><span class="z-entity z-name">shell</span><span>()  {</span><span class=z-keyword> for</span><span class="z-variable z-other"> p</span><span class=z-keyword> in</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@</span><span class="z-string z-punctuation z-definition z-string">}&quot;</span><span>;</span><span class=z-keyword> do</span><span class="z-entity z-name"> exts</span><span class="z-punctuation z-definition z-string"> &quot;</span><span class="z-variable z-other">$p</span><span class="z-punctuation z-definition z-string z-string">&quot; sh bash</span><span>;</span><span class=z-keyword> done</span><span>; }</span></span>
<span class=giallo-l><span class="z-entity z-name">python</span><span>() {</span></span>
<span class=giallo-l><span class=z-keyword>    for</span><span class="z-variable z-other"> p</span><span class=z-keyword> in</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@</span><span class="z-string z-punctuation z-definition z-string">}&quot;</span><span>;</span><span class=z-keyword> do</span></span>
<span class=giallo-l><span class="z-entity z-name">        deny</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class="z-variable z-other">p</span><span class="z-string z-punctuation z-definition z-string">}/**/.venv/&quot; &quot;${</span><span class="z-variable z-other">p</span><span class="z-string z-punctuation z-definition z-string">}/**/venv/&quot;</span></span>
<span class=giallo-l><span class="z-entity z-name">        files</span><span class="z-punctuation z-definition z-string"> &quot;</span><span class="z-variable z-other">$p</span><span class="z-punctuation z-definition z-string z-string">&quot; requirements.txt</span></span>
<span class=giallo-l><span class="z-entity z-name">        exts</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class="z-variable z-other">p</span><span class="z-string z-punctuation z-definition z-string">}/**&quot; py</span></span>
<span class=giallo-l><span class=z-keyword>    done</span></span>
<span class=giallo-l><span>}</span></span>
<span class=giallo-l><span class="z-entity z-name">golang</span><span>() {</span></span>
<span class=giallo-l><span class=z-keyword>    for</span><span class="z-variable z-other"> p</span><span class=z-keyword> in</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@</span><span class="z-string z-punctuation z-definition z-string">}&quot;</span><span>;</span><span class=z-keyword> do</span></span>
<span class=giallo-l><span class="z-entity z-name">        files</span><span class="z-punctuation z-definition z-string"> &quot;</span><span class="z-variable z-other">$p</span><span class="z-punctuation z-definition z-string z-string">&quot; go.mod go.sum</span></span>
<span class=giallo-l><span class="z-entity z-name">        exts</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class="z-variable z-other">p</span><span class="z-string z-punctuation z-definition z-string">}/**&quot; go</span></span>
<span class=giallo-l><span class=z-keyword>    done</span></span>
<span class=giallo-l><span>}</span></span>
<span class=giallo-l><span class="z-entity z-name">rust</span><span>()   {</span></span>
<span class=giallo-l><span class=z-keyword>    for</span><span class="z-variable z-other"> p</span><span class=z-keyword> in</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class=z-keyword>@</span><span class="z-string z-punctuation z-definition z-string">}&quot;</span><span>;</span><span class=z-keyword> do</span></span>
<span class=giallo-l><span class="z-entity z-name">        deny</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class="z-variable z-other">p</span><span class="z-string z-punctuation z-definition z-string">}/target&quot;</span></span>
<span class=giallo-l><span class="z-entity z-name">        exts</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class="z-variable z-other">p</span><span class="z-string z-punctuation z-definition z-string">}/src/**&quot; rs</span></span>
<span class=giallo-l><span class="z-entity z-name">        exts</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class="z-variable z-other">p</span><span class="z-string z-punctuation z-definition z-string">}/examples/**&quot; rs</span></span>
<span class=giallo-l><span class="z-entity z-name">        exts</span><span class="z-punctuation z-definition z-string z-string"> &quot;${</span><span class="z-variable z-other">p</span><span class="z-string z-punctuation z-definition z-string">}/tests/**&quot; rs</span></span>
<span class=giallo-l><span class="z-entity z-name">        files</span><span class="z-punctuation z-definition z-string"> &quot;</span><span class="z-variable z-other">$p</span><span class="z-punctuation z-definition z-string">&quot;</span><span class=z-constant> \</span></span>
<span class=giallo-l><span class=z-string>            build.rs Cargo.toml Cargo.lock</span><span class=z-constant> \</span></span>
<span class=giallo-l><span class=z-string>            rustfmt.toml clippy.toml .cargo/config.toml</span></span>
<span class=giallo-l><span class=z-keyword>    done</span></span>
<span class=giallo-l><span>}</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">##############################</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment">##############################</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name">header</span></span>
<span class=giallo-l><span class="z-entity z-name">denyallfiles</span></span>
<span class=giallo-l><span class="z-entity z-name">allowalldirs</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-punctuation z-definition z-comment z-comment"># root</span></span>
<span class=giallo-l><span class="z-entity z-name">allow</span><span class=z-constant> \</span></span>
<span class=giallo-l><span class=z-string>    .editorconfig .gitignore .mailmap</span><span class=z-constant> \</span></span>
<span class=giallo-l><span class="z-punctuation z-definition z-string z-string">    &quot;**/README.md&quot; &quot;**/.keep&quot; &quot;**/LICENSE&quot;</span></span>
<span class=giallo-l></span>
<span class=giallo-l><span class="z-entity z-name">rust</span><span class=z-string> crate-a</span></span>
<span class=giallo-l><span class="z-entity z-name">shell</span><span class="z-punctuation z-definition z-string z-string"> &quot;**&quot;</span></span></code></pre><p>To update the allowlist, simply run: <code>./gengitignore.sh > .gitignore</code><details><summary>This example generates the following</summary><div><pre class="giallo z-code"><code data-lang=gitignore data-name=.gitignore><span class=giallo-l><span class=z-comment># This should works well for crate-a</span></span>
<span class=giallo-l><span>/</span><span class=z-keyword>**</span><span>/</span><span class=z-keyword>*</span></span>
<span class=giallo-l><span class=z-keyword>!**</span><span>/</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/.editorconfig</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/.gitignore</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/.mailmap</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/</span><span class=z-keyword>**</span><span>/README.md</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/</span><span class=z-keyword>**</span><span>/.keep</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/</span><span class=z-keyword>**</span><span>/LICENSE</span></span>
<span class=giallo-l><span>/crate-a/target</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/crate-a/src/</span><span class=z-keyword>**</span><span>/</span><span class=z-keyword>*</span><span>.rs</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/crate-a/examples/</span><span class=z-keyword>**</span><span>/</span><span class=z-keyword>*</span><span>.rs</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/crate-a/tests/</span><span class=z-keyword>**</span><span>/</span><span class=z-keyword>*</span><span>.rs</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/crate-a/build.rs</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/crate-a/Cargo.toml</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/crate-a/Cargo.lock</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/crate-a/rustfmt.toml</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/crate-a/clippy.toml</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/crate-a/.cargo/config.toml</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/</span><span class=z-keyword>**</span><span>/</span><span class=z-keyword>*</span><span>.sh</span></span>
<span class=giallo-l><span class=z-keyword>!</span><span>/</span><span class=z-keyword>**</span><span>/</span><span class=z-keyword>*</span><span>.bash</span></span></code></pre></div></details><p>Thatâ€™s all for now!</section></article></main></div><footer><hr><nav><a rel=me href=/about>Hugues</a> |
<a rel=atom href=/atom.xml class="rss icon" title=rss></a><a rel=me href=https://github.com/izissise class="github icon" title=github></a><a rel=me href=https://stackoverflow.com/users/2838914/izissise class="stack icon" title=stackoverflow></a><a rel=me href=https://links.izissise.net/ class="shaarli icon" title=shaarli></a><a rel=me href=https://www.linkedin.com/in/huguesmorisset/ class="linkedin icon" title=linkedin></a><a rel=me href="=MWM2IDZ1cDN0ATMwEDMyEjYxEmM5QDMwIWNmFjYxQDMkFDNyYDNxATMygDNwEDOwEWM3MjM1QDM" class="m-protected matrix icon" title=matrix></a><a rel=me href="==wYwQWMiBjZ0QDMhJjM1QDM2AjMzIWM0ADZxQjM2QTMwYGN2ADZwITMiFTYyEDN2AzYwgDN3ATNxQDMhJjM1QDM" class="m-protected mail icon" title=email></a>| &#169; 2026